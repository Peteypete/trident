#!/bin/bash
"exec" "planck" "-c" "$(cd $(dirname ${BASH_SOURCE[0]}) && pwd)/../planck/src" "$0" "$@"
(require '[planck.core :as c])
(require '[jobryant.planck.util :refer [sh shsplit]])

(let [[command] *command-line-args*
      {:keys [version group artifact]} (c/read-string (c/slurp "lib.edn"))
      file (str "target/" artifact "-" version ".jar")]
  (assert (contains? #{"jar" "install" "deploy"} command))
  (if (= command "jar")
    (sh "clj" "-Sdeps" "{:deps {luchiniatwork/cambada {:mvn/version \"1.0.0\"}}}"
        "-m" "cambada.jar"
        "--app-group-id" group
        "--app-artifact-id" artifact
        "--app-version" version)
    (sh "clj" "-Sdeps" "{:deps {deps-deploy {:mvn/version \"RELEASE\"}}}"
        "-m" "deps-deploy.deps-deploy" command file)))
